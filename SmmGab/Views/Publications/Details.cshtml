@model SmmGab.Domain.Models.Publication
@{
    ViewData["Title"] = Model.Text;
}

<h2>@Model.Text</h2>

<div class="row mt-4">
    <div class="col-md-6">
        <h4>Информация о публикации</h4>
        <p><strong>Проект:</strong> @Model.Project.Name</p>
        <p><strong>Статус:</strong> 
            <span class="badge bg-@(Model.Status == SmmGab.Domain.Enums.PublicationStatus.Published ? "success" : 
                                 Model.Status == SmmGab.Domain.Enums.PublicationStatus.Failed ? "danger" : 
                                 Model.Status == SmmGab.Domain.Enums.PublicationStatus.Publishing ? "warning" : "secondary")">
                @Model.Status
            </span>
        </p>
        <p><strong>Создана:</strong> @Model.CreatedAtUtc.ToString("dd.MM.yyyy HH:mm")</p>
        @if (Model.ScheduledAtUtc.HasValue)
        {
            <p><strong>Запланирована на:</strong> @Model.ScheduledAtUtc.Value.ToString("dd.MM.yyyy HH:mm")</p>
        }
        @if (Model.PublishedAtUtc.HasValue)
        {
            <p><strong>Опубликована:</strong> @Model.PublishedAtUtc.Value.ToString("dd.MM.yyyy HH:mm")</p>
        }
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.DeltaQuill))
{
    <div class="mt-4">
        <h4>Содержание</h4>
        <div class="border p-3">
            <pre>@Model.DeltaQuill</pre>
        </div>
    </div>
}

<div class="mt-4">
    <h4>Цели публикации (@Model.Targets.Count)</h4>
    @if (Model.Targets.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Канал</th>
                    <th>Тип</th>
                    <th>Статус</th>
                    <th>Ошибка</th>
                    <th>Опубликовано</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var target in Model.Targets)
                {
                    <tr>
                        <td>@target.Channel.DisplayName</td>
                        <td>@target.ChannelType</td>
                        <td>
                            <span class="badge bg-@(target.Status == SmmGab.Domain.Enums.TargetStatus.Published ? "success" : 
                                         target.Status == SmmGab.Domain.Enums.TargetStatus.Failed ? "danger" : 
                                         target.Status == SmmGab.Domain.Enums.TargetStatus.Publishing ? "warning" : "secondary")">
                                @target.Status
                            </span>
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(target.LastError))
                            {
                                <span class="text-danger" title="@target.LastError">@target.LastError</span>
                            }
                            else
                            {
                                <text>-</text>
                            }
                        </td>
                        <td>@(target.PublishedAtUtc?.ToString("dd.MM.yyyy HH:mm") ?? "-")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted">Нет целей публикации</p>
    }
</div>

@if (Model.Files.Any())
{
    <div class="mt-4">
        <h4>Файлы (@Model.Files.Count)</h4>
        <ul class="list-group">
            @foreach (var file in Model.Files)
            {
                <li class="list-group-item">
                    <a href="/api/files/@file.Id/download" target="_blank">@file.StoredFileName</a>
                    <small class="text-muted">(@file.FileSizeBytes bytes, @file.ContentType)</small>
                </li>
            }
        </ul>
    </div>
}

<div class="mt-4">
    @if (Model.Status == SmmGab.Domain.Enums.PublicationStatus.Scheduled || Model.Status == SmmGab.Domain.Enums.PublicationStatus.Draft)
    {
        <form asp-action="PublishNow" asp-route-id="@Model.Id" method="post" class="d-inline">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-primary">Опубликовать сейчас</button>
        </form>
    }
    <a asp-action="Index" class="btn btn-secondary">Назад к списку</a>
</div>

